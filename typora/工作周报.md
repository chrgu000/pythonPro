# 工作周报

## 6.9

1、更新经纬度地址信息字段，通过crm_t_clue表的经纬度字段，调用百度地图api接口，补全更新省市县街道字段。目前代码已调通，正在跑数据，预计需要7天，在百度地图注册了企业接口，限制300w/day.

2、关键词提取，相似线索计算。
​       删除非汉字形式的字符，标点，删除jieba分词后len（词）<1的词，即停止词过滤。
​       计算每一个公司简介中高频汉字
​       计算词的tf-idf。每一个词的weigth=tf-idf+w*(高频汉字在该此中出现的次数)

## 6.16

1、天眼查，爬取数据，给出公司名称，查13个字段，返回的json存入数据库
2、公司简介关键词提取优化
   关键词权重计算方式：1)计算tf-idf 的weight值 ;2)根据词性调整weight；3）限定词删除；4）根据字频权重调整weight值；5）给出根据排序后最重要的10   个关键词。
   缺陷：计算时间长，随着文本数据增多，时间消耗严重；仅500数据的实验，耗时3min。
   结果：公司名称按规则给出一个重要词+公司简介给出10个重要词=11个词，基本能说明公司性质。

## 6.23

1、更新数据库省市字段信息
2、查询天眼查数据，调用接口
3、线索相似度，先使用小样本1000条线索，给出每一个线索最相似线索，结果见附件

## 6.30

1、调百度地图接口代码java转python
2、重更新数据库，由三个字段信息(省 市 其余)改为四个字段信息(省 市 县/区 其余)。
3、解决tf-idf效率问题：生成中间信息存储成字典，在计算idf时直接调用，不用每次计算都重新生成，而且如果有新数据加入，可以在此基础上继续添加使用

## 7.3

1、更新es数据库地理信息字段，（es更新使用bulk时，一次不能更太多条数据，否则失败）
2、更新es关键词字段
3、爬取高德地图，爬线索周边信息

## 7.14

1、主要研究了一下用户行为表，包括表与表之间关联关系，字段表示等。

## 7.21

1、生成每一个公司的训练集、测试集。
2、特殊建筑物的数据准备
3、解决之前程序在获取高德信息时经常卡死的问题
3、训练客户（客户名称：传感器，客户code:6rmj6n），完成模型框架，进行简单训练（包含特征38个，未加关键词特征，并且提取的都是比较全的字段），接下来补全数据后抽取新特征。

## 7.28

1、特殊建筑物数据爬取结束
2、将特殊建筑物数据存入mongoDB
3、详细的预特征表，包含crm_t_clue和天眼查两部分。开会讨论后，修正。
4、推荐过程框架讨论，初步定型，待生成书面

## 8.3

1、清洗部分明显的职位列表，比如 GM值应该是表示成总经理
2、建立特征表，抽取线索表字段，com_site, com_type ,employees_num, registed_capital, major，date 标准化，转换成特征向量，存入特征表

## 8.11

  1、对于推荐系统，讨论计划出整体方案，并给出具体每人负责表
  2、北京地区,建筑物与线索关联:
​    2.1 将特殊建筑物建表，通过调取高德接口，获取建筑物所在地址，表中存建筑物名称，建筑物地址（多个地址）
​    2.2 特殊建筑物（只高德建筑物），北京地区建筑物与线索关联，覆盖率：1.5%
​    2.3 特殊建筑物（高德建筑物(5500)+好租写字楼（1600个）），北京地区建筑物与线索关联，覆盖率：2.3%
​    2.4 匹配过程：大厦名称匹配，寻求建筑物与线索关联
  3、生成可用的正负样本，对负样本有两种获取方式
​    3.1 通过线索库中不感兴趣表（crm_t_usernotinterested_clue），可用客户不多(云客、企办有数据)，但是比3.2获取负样本更合理
  4、特征表修改：
​      4.1 c_reg_captical修改，线索表注册资金改变，之前存储注册资金由registed_capital变换registed_capital_num错误：比如3730.9132万元人民币转换成了373091320000人民币
​      4.2 c_reg_date ,修改成timestamp类型，重新生成

## 8.18

  1、修改线索表，字段registed_capital_num部分存储错误
  2、北京地区,建筑物与线索关联:匹配过程分多次清洗匹配，（给出每一线索与建筑物匹配的匹配程度）
​    2.1 第一次：绝对匹配方式：大厦名称匹配，寻求建筑物与线索关联(覆盖率：14%)
​    2.2 第二次：地址模糊匹配方式：地址匹配地址的方式(覆盖率：25%)
​    2.3 第三次：匹配方式：线索地址经纬度，调用高德接口返回周边大厦，选择其中最近的大厦作为结果，通过
​                          实验，这个方法的效果较好，且得到的覆盖率较高(63%)
​                缺点：返回的距离如果太大，不能完全保证公司是否在该建筑物里

  3、数据闭环问题，通过云电销打过的电话，我们能返回什么样的信息更新数据库线索-框架
​     3.1、基于现有的状况，本周拿出如何实现数据闭环的策略，要充分考虑清楚数据流转过程中产生回收信息的可能性及对应策略
​     3.2、针对天眼查之前的数据，拿出反馈，要有数据支撑及人员沟通
  4、模型框架搭建，初步实现个性化客户推荐（metrics:准确率）
​     4.1、逻辑回归模型，使用云客推荐（正确率：0.945）
​     4.2、逻辑回归模型，企办数据推荐(正确率：0.965)

## 8.25

​    1、将楼宇相关的信息解析，存入buildings_info表中，补全字段：
​       1.1 第一批信息：好租网上的数据解析，导入到建筑物表
​       1.2 补全地理位置信息，补齐建筑物图片展示信息,存入数据库表
​    2、建筑物匹配线索：统计字段（70% 占比以上可用）：
​        1.1 统计：地址(98%)、楼宇面积(17.5%)、楼宇描述信息(17.5)、物业公司、物业电话、图片(70%)
​    3、模型训练：
​       3.1、模型不同负样本生成模型对比：
​            方式一：负样本源于数据库不感兴趣线索表
​            方式二：随机抽取未打过的线索
​            方式三：方式一和方式二负样本和
​                          方式一            方式二            方式一+方式二
​       云客 yunkecn    0.691599539701     0.476973684211     0.624140565317

​       3.2、添加过滤模块
​             过滤1，删除已经推荐过得线索,和用户不感兴趣的线索
​       3.3 时间衰减策略研究（基于用户投票的排序算法）
​              Delicious、Hacker News、（**）Reddit、Stack Overflow、牛顿冷却定律、（*）威尔逊区间、贝叶斯平均
​    4、文本特征处理（加入线索的文本特征）：
​       4.1 使用LDA模型(模型跑不起来，数据量太大)

## 9.1

​    1、通过时间衰减策略,计算出线索有效性指标，并存入特征表vaildity_score字段
​    2、将楼宇相关的信息解析，存入buildings_info表中，补全字段：
​          第二批数据：房天下数据解析，存储
​                      房天下图片load，存储
​          统计各个字段补全比例
​    3、有效性评分修改，将线索type特征加入将计算出的有效性范围缩小至[0,100]
​    4、重新解析好租,房天下信息，用房天下信息补齐好租信息
​    5、将建筑物-线索匹配提高至94%，6%匹配不到可能由于不存地址信息，或者建筑物无名等原因
​        北京地区线索：1386329  已被匹配到建筑物的线索：1304042 ,82287条线索无法匹配到建筑物
​        建筑物数量增至：1950（但是其中包含重复的，比如金泰国际大厦A座，金泰国际大厦B座存储成了两条建筑物，但是都应属于金泰国际大厦）
​       5.1 新增建筑物抓取地址信息，更新到sql表

​       5.2 修改异常建筑信息，建筑物通过名称匹配的错误，办公楼成为一个楼宇名称，通过名称匹配，1w+个线索被匹配错误

​    6、powermap使用，测试，给出线索-楼宇分布热图

## 9.8

​    1、线索匹配过程自动化处理，脚本形式，尽可能少的人工干预
​       1.1 对于未匹配成功的另存入company_no_match表，从company_connection_building删除对应公司id
​       1.2 对于未匹配到的线索进行特殊匹配
​       1.3 对于新来的线索写成脚本，检测到company_yunke表有新插入线索，则自动进行线索匹配的过程，同时，将匹配到的和未匹配到的公司分别更新到
​           对应数据表，对于新查到的楼宇插入的建筑物表
​           建筑物：19615个，  覆盖率=0.94189754653844
​    2、修改公司员工人数特征，有小部分数据异常
​    3、模型（GBDT+LR，模拟广告点击预估）：
​        3.1 文本特征处理（加入线索的文本特征）：
​            3.1 tf-idf提取的关键词，建立词库，对每一条线索抽出的关键词，形成关键词向量（缺陷：高维，但是可并行处理）
​            3.2 关键词向量特征存入数据库clue_feature表
​        3.2 模型训练：新加入的特征，特征维度：
​        3.3 使用GBDT预选择特征文本特征，特征由10w+降至？

## 9.15

​    1、模型（GBDT+LR，模拟广告点击预估）：
​        1.1 模型训练：新加入的特征，特征维度：7W；地理位置编码做onehot处理
​        1.2 使用GBDT预选择特征文本特征，特征由7w降至与迭代树叶子结点和相等
​        1.3 添加随机样本测试模块（对随机的线索使用模型推荐，生成正样本文件，负样本文件）
​        1.4 对比实验(见附件)：
​            加入非结构性数据与不加入非结构性数据对比
​            gbdt+lr与lr对比
​    2、楼宇数据：
​        2.1、电话号码字段，经纬度字段补齐
​        2.2、统计建筑物中企业信息字段
​            企业总数，商标信息，专利，著作权，招聘信息，行业分布，注册时间分布，注册资本分布
​            著作权：办理总数，办理企业，未办理企业
​            专利：办理总数，办理企业，未办理企业
​            著作权：办理总数，办理企业，未办理企业
​        2.3、添加楼宇信息、添加企业信息，更新以上字段
​    3、定时任务：训练集正样本数据，call_record表存储，定时更新

## 9.22

​    1、地图搜索功能：
​        1.1、添加楼宇接口
​        1.2、添加楼宇-公司关系接口
​        1.3、例：xx大厦，xx大厦A座信息处理逻辑（当选择xx大厦时，包含xx大厦A座信息，如果选择xx大厦A座，则值包含该楼信息），数据修改
​        1.4、将xx大厦的信息填充到xx大厦A座字段信息
​        1.5、解决地图定位不准确问题
​        1.6、解决饼图显示问题，联系表增加注册时间，注册资本，行业分布，天眼评分四个字段
​        1.7、页面显示的信息与数据库字段对应的关系文档
​        1.8、修改 ：行业分布，注册时间分布，注册资本分布,删除值=0的key

## 9.30
    1、地图接口功能
​       1.1、年份字段格式修改，做成动态的
​       1.2、楼宇-企业联系表添加：企业名称、企业法人、地址、注册资本、注册时间、状态
​       1.3、页面显示问题：更新c_cstatus字段，删除括号中的内容
​       1.4、统一注册资本单位格式
       1.5、日期格式统一，具体年份修改日期段格式
​    2、定时任务：有效性评分定时计算
​    4、模型接口：调用接口，返回推荐结果

2017.10.13
    1、地图数据：
        1.1、统一建筑物表中空字段格式
        1.2、company_connection_building表c_id(工商id)修改成mongodb_Id
    2、推荐：
       2.1、推荐接口，请求给出companycode,返回多个clueid，即推荐结果
            1、添加处理无法找到该客户的已有模型的情况
            2、添加处理无模型情况，立即生成该客户模型时，失败的情况
       2.2、模型定时更新任务
           维护每一个客户推荐模型，非实时生成，只有用户在当天使用时，模型会在当天使用新训练数据凌晨更新
    3、定时任务：对之前导入的客户数据添加线索ID（每天凌晨处理当天打过的线索）
       3.1、crm_t_plan_customer Clue_Key添加对应线索id

2017.10.16
    1、地图数据：
        1.1、company_connection_building表c_id(工商id)修改成mongodb_Id
        1,2、企业总数数据不对
        1.3、图表排序（1、行业按数量由多到少，2、注册时间按时间由近到远，3、注册资本按资本由高到低）
        1.4、将字段中所有的“无”改为“保密”
        1.5、修改：具体显示的注册资金、日期、企业状态与企业报告保持一致
    2、推荐：
        2.1、整理之前关于推荐的工作，写成文档
        2.2、添加推荐逻辑：记录每一个客户的推荐记录，每次调用接口时，读取记录，接上次推荐继续读取数据库数据
        2.2、缓存客户下一次的推荐结果，每次客户调用，直接读取该缓存，并计算出下次推荐结果 （待做）

2017.10.23
   地图：
   1、添加初始显示楼宇功能
       1.1、在company_connection_building添加两层地理层级(区层级,路层级)
       1.2、新建表：添加对应层级的中心经纬度;添加对应区域的统计楼宇数
   2、数据质量：
        2.1、根据呼叫记录的标签得到无效线索id，根据企业状态得到无效线索id
             当线索入库时，每个线索调用该接口进行判定企业是否活跃，如果企业是注销状态，则放入停用表
​             对每天被打过电话的线索清洗，如果线索手机号被标记为空号或停机，将该线索移除至停用表
   ##写转正申请表







待做：
​        1、建筑物介绍还可添加字段：物业费、容积率、绿化率、产权、停车位
​        2、楼宇分类型：大厦/写字楼，科技园/工业园/商业园，居民小区
​        3、分词工具的比较
        4、将之前的写过的功能整理
        5、特征表clue_feature移到mongodb中
        6、职位标准化

